package org.applecommander.bastools.api.proofreaders;

import org.junit.Test;

import static org.junit.Assert.assertEquals;

public class MicrosparcKeyPerfect4BinaryTest {
    // From Nibble, August 1984, BEACH.SHAPES
    @Test
    public void testBeachShapes() {
        final int[] code = {
                  0x02, 0x00, 0x06, 0x00, 0x1D, 0x00, 0x06,     // $0801
            0x07, 0x05, 0x05, 0x05, 0x05, 0x07, 0x07, 0x07,     // $0808
            0x06, 0x06, 0x07, 0x06, 0x07, 0x05, 0x04, 0x05,     // $0810
            0x05, 0x06, 0x05, 0x07, 0x00, 0x00, 0x05, 0x06,     // $0818
            0x07, 0x06, 0x05, 0x06, 0x07, 0x06, 0x07, 0x07,     // $0820
            0x04, 0x07, 0x04, 0x07, 0x04, 0x06, 0x05, 0x06,     // $0828
            0x05, 0x06, 0x05, 0x05, 0x05, 0x05, 0x05, 0x04,     // $0830
            0x05, 0x04, 0x05, 0x07, 0x06, 0x07, 0x06, 0x07,     // $0838
            0x06, 0x07, 0x07, 0x07, 0x06, 0x07, 0x07, 0x07,     // $0840
            0x07, 0x07, 0x07, 0x05, 0x05, 0x06, 0x06, 0x07,     // $0848
            0x06, 0x04, 0x05, 0x04, 0x05, 0x05, 0x04, 0x05,     // $0850
            0x05, 0x05, 0x05, 0x05, 0x05, 0x05, 0x04, 0x05,     // $0858
            0x04, 0x05, 0x04, 0x06, 0x07, 0x06, 0x06, 0x05,     // $0860
            0x07, 0x07, 0x07, 0x07, 0x07, 0x06, 0x06, 0x05,     // $0868
            0x06, 0x05, 0x06, 0x05, 0x06, 0x04, 0x07, 0x04,     // $0870
            0x07, 0x07, 0x06, 0x06, 0x06, 0x06, 0x07, 0x04,     // $0878
            0x04, 0x04, 0x04, 0x04, 0x04, 0x07, 0x06, 0x07,     // $0880
            0x06, 0x07, 0x06, 0x07, 0x06, 0x07, 0x05, 0x00,     // $0888
            0x06                                                // $0890
        };
        // First run through the checksum routine
        final int[] expectedChecksums = { 0x25dc, 0x2553 };
        final int bytesInChecksum = 0x50;
        MicrosparcKeyPerfect4Checksum checksum = new MicrosparcKeyPerfect4Checksum();
        int currentChecksum = 0;
        for (int i=0; i<code.length; i++) {
            if (i > 0 && i % bytesInChecksum == 0) {
                assertEquals(expectedChecksums[currentChecksum], checksum.value());
                checksum.reset();
                currentChecksum++;
            }
            checksum.add(code[i]);
        }
        assertEquals(expectedChecksums[currentChecksum], checksum.value());     // last value
    }
}
