commands:
  bt:
    main-class: org.applecommander.bastools.tools.bt.Main
    system-exit: yes
    executable:  tools/bt/build/native/nativeCompile/bt-*

files:
  helloWorld:
    type: text
    content: |
      10 TEXT
      20 HOME
      30 PRINT "HELLO, WORLD"
      40 END
    suffix: .bas
  numberPreservation:    # See https://github.com/AppleCommander/bastools/issues/49
    type: text
    content: |
      10 PRINT "MATHING"
      30 A = .4
      40 B = 0.6000
      50 C = -.250
      60 D = -0.70
      70 PRINT "A=";A
      80 PRINT "B=";B
      90 PRINT "C=";C
      95 PRINT "D=";D
    suffix: .bas

tests:
  - name: Forms of help
    steps:
      - command: bt --help
        criteria:
          match: contains
        stdout: "Usage: bt"
      - command: bt
        criteria:
          match: contains
        stderr: "Usage: bt"
        rc: 2
  - name: list output
    steps:
      - command: bt --list $helloWorld
        criteria:
          whitespace: trim
        stdout: |
          10  TEXT
          20  HOME
          30  PRINT "HELLO, WORLD"
          40  END
  - name: copy/paste output
    steps:
      - command: bt --copy $helloWorld
        criteria:
          whitespace: trim
        stdout: |
          0067:01 08
          00AF:2A 08
          0800:00
          0801:07 08 0A 00 89 00 0D 08 14 00 97 00 21 08 1E 00
          0811:BA 22 48 45 4C 4C 4F 2C 20 57 4F 52 4C 44 22 00
          0821:27 08 28 00 80 00 00 00
  - name: optimize output
    steps:
      - command: bt --optimize --list $helloWorld
        criteria:
          whitespace: trim
        stdout: |
          0  TEXT : HOME : PRINT "HELLO, WORLD": END
  - name: wrap output
    steps:
      - command: bt --wrapper --hex $helloWorld
        criteria:
          whitespace: trim
        stdout: |
          0801: 16 08 0a 00 b9 31 30 33 2c 32 34 3a b9 31 30 34  .....103,24:.104
          0811: 2c 38 3a ac 00 00 00 1e 08 0a 00 89 00 24 08 14  ,8:..........$..
          0821: 00 97 00 38 08 1e 00 ba 22 48 45 4c 4c 4f 2c 20  ...8...."HELLO,
          0831: 57 4f 52 4c 44 22 00 3e 08 28 00 80 00 00 00 ..  WORLD".>.(..... 
  - name: check number preservation
    steps:
      # This keeps numbers as-is
      - command: bt --preserve --list $numberPreservation
        criteria:
          whitespace: trim
        stdout: |
          10  PRINT "MATHING"
          30 A = .4
          40 B = 0.6000
          50 C =  - .250
          60 D =  - 0.70
          70  PRINT "A=";A
          80  PRINT "B=";B
          90  PRINT "C=";C
          95  PRINT "D=";D
  - name: check numbers not being preserved
    variables:
      switch: ["--modern", "--classic"]
    steps:
      # These rewrite numbers
      - command: bt $switch --list $numberPreservation
        criteria:
          whitespace: trim
        stdout: |
          10  PRINT "MATHING"
          30 A = 0.4
          40 B = 0.6
          50 C =  - 0.25
          60 D =  - 0.7
          70  PRINT "A=";A
          80  PRINT "B=";B
          90  PRINT "C=";C
          95  PRINT "D=";D
